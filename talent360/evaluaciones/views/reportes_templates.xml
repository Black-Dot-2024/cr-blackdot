<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Layout copiado de los reportes de encuestas de odoo -->
        <template id="evaluaciones.layout" name="Survey Layout" inherit_id="web.frontend_layout" primary="True">
            <xpath expr="//div[@id='wrapwrap']" position="before">
                <!--TODO DBE Fix me : If one day, there is a survey_livechat bridge module, put this in that module-->
                <t t-set="no_livechat" t-value="True"/>
            </xpath>
            <xpath expr="//div[@id='wrapwrap']" position="attributes">
                <attribute name="t-attf-class" add="o_survey_background" separator=" "/>
            </xpath>
            <xpath expr="//head/t[@t-call-assets][last()]" position="after">
                <t t-call-assets="survey.survey_assets" lazy_load="True"/>
            </xpath>
            <xpath expr="//header" position="before">
                <t t-set="no_header" t-value="True"/>
                <t t-set="no_footer" t-value="True"/>
            </xpath>
            <xpath expr="//header" position="after">
                <div id="wrap" class="oe_structure oe_empty"/>
            </xpath>
        </template>


        <template id="survey_page_statistics" name="Survey: result statistics page">
            <t t-call="evaluaciones.layout">
                <t t-set="page_record_limit" t-value="10"/>
                <div class="container o_survey_result">
                    <t t-call="evaluaciones.survey_page_statistics_header" />
                    <t t-call="evaluaciones.survey_page_statistics_inner" />
                </div>
            </t>
        </template>

        <template id="survey_page_statistics_header" name="Survey: result statistics header">
            <div class="o_survey_statistics_header mt32">
                <div class="d-flex justify-content-between">
                    <div class="d-block">
                        <h1>
                            <span t-field="evaluacion.nombre"/>
                        </h1>
                    </div>
                    <h2 t-if="not question_and_page_data">
                    Sorry, no one answered this survey yet.
                    </h2>
                </div>
                <button class="btn btn-primary d-none d-print-none d-md-inline-block o_survey_results_print" aria-label="Print" title="Print">
                    <i class="fa fa-print"></i> Print
                </button>
            </div>
        </template>

        <template id="survey_page_statistics_inner" name="Survey: result statistics content">
            <div t-foreach="question_and_page_data" t-as='question_data'>
                <t t-set="question" t-value="question_data['question']"/>
                <div class="ms-4 mt-5 o_survey_results_question_wrapper" t-call="evaluaciones.survey_page_statistics_question" />
            </div>
        </template>

        <template id="survey_page_statistics_question" name="Question: result statistics">
            <!-- <t t-set="comment_lines" t-value="question_data['comment_line_ids']"/>
            <t t-set="graph_data" t-value="question_data['graph_data']"/> -->
            <!-- <t t-set="table_data" t-value="question_data['table_data']"/> -->
            <t t-set="default_line_height" t-value="35"/>
            <!-- 1 line/answer -->
            <t t-set="text_box_line_height" t-value="83"/>
            <!-- 3 lines/answer -->

            <div class="o_survey_results_question pb-5 border-bottom">
                <div class="d-flex mb-3 o_survey_results_question_header">
                    <div class="d-flex flex-wrap mb-1">
                        <button class="btn btn-link ps-0 pt-2 d-print-none" type="button" data-bs-toggle="collapse" t-attf-data-bs-target=".o_survey_results_question_#{question.id}">
                            <i class="fa fa-eye" aria-hidden="true"/>
                        </button>
                        <h5 t-field="question.pregunta_texto" class="pt-2 mb-0 me-1"/>
                    </div>
                    <!-- Question info -->
                    <div t-attf-class="d-flex flex-fill justify-content-end align-items-end mb-1 collapse show o_survey_results_question_#{question.id}">
                        <!-- Inputs info -->
                        <span class="badge ms-0 ms-sm-1 me-1 me-sm-0">
                            <span t-out="len(question_data['respuestas'])" class="d-block mb-1 text-info text-start"/>
                            <span class="d-block text-muted">Respuestas</span>
                        </span>
                    </div>
                </div>
                <div t-attf-class="collapse show o_survey_results_question_#{question.id}">
                    <!-- Answers -->
                    <t t-set="question_answered" t-value="question_data['respuestas']"/>
                    <div t-if="not question_answered" class="o_survey_no_answers text-center fw-bold">
                        <p>Aun no hay respuestas</p>
                    </div>
                    <t t-elif="question.tipo in ['open_question']" t-call="evaluaciones.question_result_text"/>
                    <t t-elif="question.tipo in ['escala', 'multiple_choice']" t-call="evaluaciones.question_result_choice"/>
                </div>
            </div>
        </template>



        <template id="question_result_text" name="Question: text result (text_box, char_box)">
            <t t-set="respuestas" t-value="question_data['respuestas']"/>
            <t t-set="first_page_records_count" t-value="len(respuestas) if len(respuestas) &lt; page_record_limit else page_record_limit"/>
            <t t-set="cell_height" t-value="default_line_height"/>
            <div t-attf-style="height: auto" class="overflow_auto o_survey_user_responses_table_wrapper">
                <table class="table table-hover table-sm o_survey_results_table_indexed" t-att-id="'survey_table_question_%d' % question.id">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Respuestas</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="respuestas" t-as="respuesta">
                            <tr t-att-class="'d-none' if not respuesta in respuestas[:page_record_limit] else ''">
                                <td>
                                    <t t-esc="respuesta_index + 1"></t>
                                </td>
                                <td>
                                    <div class="d-flex justify-content-between">
                                        <t t-esc="respuesta"/>
                                    </div>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
            <t t-call="evaluaciones.question_table_pagination"/>
        </template>

        <template id="question_result_choice" name="Question: choice result (simple_choice, multiple_choice)">
            <t t-set="respuestas" t-value="question_data['respuestas']"/>
            <ul class="nav nav-tabs d-print-none" role="tablist">
                <!-- <li t-if="question_answered" class="nav-item">
                    <a t-att-href="'#survey_graph_question_%d' % question.id" t-att-aria-controls="'survey_graph_question_%d' % question.id" class="nav-link active" data-bs-toggle="tab" role="tab">
                        <i class="fa fa-bar-chart-o"></i>
                        <span t-if="question.question_type == 'simple_choice'">Pie Graph</span>
                        <span t-else="">Graph</span>
                    </a>
                </li> -->
                <li class="nav-item">
                    <a t-att-href="'#survey_data_question_%d' % question.id" t-att-aria-controls="'survey_data_question_%d' % question.id" t-attf-class="nav-link #{'active' if not question_answered else ''}" data-bs-toggle="tab" role="tab">
                        <i class="fa fa-list-alt me-1"/>
Data
                    </a>
                </li>
            </ul>
            <div class="tab-content">
                <!-- <div t-if="question_answered" role="tabpanel" class="tab-pane active survey_graph" t-att-id="'survey_graph_question_%d' % question.id" t-att-data-question-id="question.id" t-att-data-graph-type="'pie' if question.question_type == 'simple_choice' else 'bar'" t-att-data-graph-data="graph_data" t-att-data-right-answers="list(question_data['right_answers'].mapped('value'))">
                    canvas element for drawing bar chart
                    <canvas class="mx-auto"/>
                </div> -->
                <div role="tabpanel" t-att-id="'survey_data_question_%d' % question.id" t-attf-class="tab-pane #{'active' if not question_answered else ''}">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Respuesta</th>
                                <th>User Choice</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr t-foreach="respuestas" t-as="respuesta">
                                <td>
                                    <p>
                                        <span t-esc="respuesta"/>
                                    </p>
                                </td>
                                <td class="o_survey_answer">
                                    <p> 1 </p>
                                    <!-- <span t-esc="round(choice_data['count'] * 100.0/ (len(question_data['answer_line_done_ids']) or 1), 2)"></span> %
                                    <span t-esc="'%s Votes' % choice_data['count']" class="badge text-bg-primary"/> -->
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </template>

        <template id="question_table_pagination" name="Survey: statistics table pagination">
            <t t-set="respuestas_count" t-value="len(question_data['respuestas'])"/>
            <t t-if="respuestas_count > page_record_limit">
                <div class="d-flex justify-content-between d-print-none pagination_wrapper" t-att-id="'pagination_%d' % question.id" t-att-data-question_id="question.id" t-att-data-record_limit="page_record_limit">
                    <ul class="pagination mt-2">
                        <t t-set="total" t-value="ceil(respuestas_count / page_record_limit) + 1"/>
                        <li t-foreach="range(1, total)" t-as="num" t-att-class="'page-item o_survey_js_results_pagination %s' % ('active' if num == 1 else '')">
                            <a href="#" class="page-link" t-esc="num"></a>
                        </li>
                    </ul>
                    <button class="btn btn-sm btn-primary mx-0 my-3 o_survey_question_answers_show_btn">Show All</button>
                </div>
            </t>
        </template>
    </data>
</odoo>
